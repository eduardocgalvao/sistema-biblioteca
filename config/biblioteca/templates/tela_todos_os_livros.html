{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todos os Livros - BookStack</title>

    <link rel="stylesheet" href="{% static 'css/tela_todos_os_livros.css' %}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="livros-container">
      <div class="top-bar">
        <a href="{% url 'tela_inicial' %}" class="voltar">‚Üê</a>

        <div class="search-box">
          <input type="text" placeholder="Procurar por nome do livro..." />
        </div>

        <img src="/static/img/logo.png" class="logo-bookstack" />
      </div>

      <div class="card-tabela">
        <table class="tabela-livros">
          <thead>
            <tr>
              <th>A√ß√µes</th>
              <th>T√≠tulo</th>
              <th>Ano Publica√ß√£o</th>
              <th>Editora</th>
              <th>Status</th>
              <th>Autores</th>
              <th>Categoria</th>
              <th>Data de Cria√ß√£o</th>
              <th>Data de Atualiza√ß√£o</th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td class="acoes-cell">
                <span class="edit-icon" data-id="1">‚úèÔ∏è</span>
                <span class="delete-icon" data-id="1">üóëÔ∏è</span>
              </td>
              <td>Dom Casmurro</td>
              <td>1899</td>
              <td>Bloomsbury Publishing / Rocco Presen√ßa</td>
              <td>Ativo</td>
              <td>Machado de Assis</td>
              <td>Romance</td>
              <td>16/02/2022</td>
              <td>17/02/2022</td>
            </tr>

            <tr>
              <td class="acoes-cell">
                <span class="edit-icon" data-id="2">‚úèÔ∏è</span>
                <span class="delete-icon" data-id="2">üóëÔ∏è</span>
              </td>
              <td>Harry Potter and The Cursed Child</td>
              <td>2016</td>
              <td>Editora Carambaia</td>
              <td>Ativo</td>
              <td>J. K. Rowling</td>
              <td>Fantasia</td>
              <td>17/12/2024</td>
              <td>13/09/2025</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Modal de edi√ß√£o -->
    <div id="edit-modal" class="modal hidden">
      <div class="modal-content">
        <span class="close-modal">√ó</span>

        <div class="form-grid">
          <div class="campo">
            <label>T√≠tulo:</label>
            <input type="text" id="edit-titulo" />
          </div>

          <div class="campo">
            <label>Editora:</label>
            <input type="text" id="edit-editora" />
          </div>

          <div class="campo">
            <label>Autores:</label>
            <input type="text" id="edit-autores" />
          </div>

          <div class="campo">
            <label>Ano Publica√ß√£o:</label>
            <input type="text" id="edit-ano" />
          </div>

          <div class="campo">
            <label>Endere√ßo:</label>
            <input type="text" id="edit-endereco" />
          </div>

          <div class="campo">
            <label>Categoria:</label>
            <input type="text" id="edit-categoria" />
          </div>

          <div class="campo">
            <label>Status:</label>
            <input type="text" id="edit-status" />
          </div>

          <div class="campo">
            <label>Cidade:</label>
            <input type="text" id="edit-cidade" />
          </div>
        </div>

        <div class="btn-area">
          <button class="btn-salvar">Salvar Altera√ß√£o</button>
        </div>
      </div>
    </div>

    <!-- Modal de confirma√ß√£o para excluir -->
    <div id="delete-modal" class="modal hidden">
      <div class="modal-content delete-modal">
        <span class="close-modal">√ó</span>
        <h3>Confirmar Exclus√£o</h3>
        <p>Tem certeza que deseja excluir este livro?</p>
        <p id="delete-book-title" class="book-title"></p>
        <div class="modal-buttons">
          <button class="btn-cancelar">Cancelar</button>
          <button class="btn-confirmar-exclusao">Excluir</button>
        </div>
      </div>
    </div>

    <script>
      // Vari√°veis para controle
      let livroParaExcluir = null;
      
      // Abre o modal de edi√ß√£o
      document.querySelectorAll(".edit-icon").forEach((icon) => {
        icon.addEventListener("click", () => {
          document.getElementById("edit-modal").classList.remove("hidden");
        });
      });

      // Abre o modal de exclus√£o
      document.querySelectorAll(".delete-icon").forEach((icon) => {
        icon.addEventListener("click", function() {
          const bookId = this.getAttribute("data-id");
          const row = this.closest("tr");
          const bookTitle = row.querySelector("td:nth-child(2)").textContent;
          
          livroParaExcluir = {
            id: bookId,
            element: row,
            title: bookTitle
          };
          
          // Mostra o t√≠tulo do livro no modal
          document.getElementById("delete-book-title").textContent = `"${bookTitle}"`;
          document.getElementById("delete-modal").classList.remove("hidden");
        });
      });

      // Fecha modais no X
      document.querySelectorAll(".close-modal").forEach((closeBtn) => {
        closeBtn.addEventListener("click", function() {
          this.closest(".modal").classList.add("hidden");
          livroParaExcluir = null;
        });
      });

      // Fecha modais ao clicar fora
      document.querySelectorAll(".modal").forEach((modal) => {
        modal.addEventListener("click", (e) => {
          if (e.target.classList.contains("modal")) {
            modal.classList.add("hidden");
            livroParaExcluir = null;
          }
        });
      });

      // Confirma exclus√£o
      document.querySelector(".btn-confirmar-exclusao").addEventListener("click", () => {
        if (livroParaExcluir) {
          // Aqui voc√™ pode adicionar uma chamada AJAX para excluir do banco de dados
          console.log(`Excluindo livro ID: ${livroParaExcluir.id} - ${livroParaExcluir.title}`);
          
          // Remove a linha da tabela
          livroParaExcluir.element.remove();
          
          // Fecha o modal
          document.getElementById("delete-modal").classList.add("hidden");
          livroParaExcluir = null;
          
          // Mostra mensagem de sucesso (opcional)
          alert("Livro exclu√≠do com sucesso!");
        }
      });

      // Cancela exclus√£o
      document.querySelector(".btn-cancelar").addEventListener("click", () => {
        document.getElementById("delete-modal").classList.add("hidden");
        livroParaExcluir = null;
      });
    </script>
  </body>
</html>