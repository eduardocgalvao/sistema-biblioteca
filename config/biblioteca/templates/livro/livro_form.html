<!-- biblioteca/templates/livro/livro_form.html -->
{% extends 'base.html' %} {% load static %} {% block title %}Adicionar Livro -
BookStack{% endblock %} {% block extra_css %}
<!-- Arquivo CSS principal da página -->
<link rel="stylesheet" href="{% static 'css/livro_form.css' %}" />

<!-- Biblioteca Select2 para selects avançados -->
<link
  href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
  rel="stylesheet"
/>
{% endblock %} {% block content %}

<!-- Header com botão de voltar -->
<div class="top-header">
  <a href="{% url 'home' %}" class="back-btn">←</a>
  <img src="{% static 'img/logo.png' %}" alt="Logo BookStack" class="logo" />
</div>

<!-- Container central que envolve o formulário -->
<div class="container">
  <!-- Título principal da página -->
  <h1 class="titulo">Adicione um Novo Livro</h1>

  <!-- Formulário único usado para criar o livro -->
  <form class="form" method="POST" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- Campo de upload da capa -->
    <div class="form-group">
      <label for="{{ form.capa.id_for_label }}">Capa do Livro:</label>
      {{ form.capa }}

      <!-- Exibição de erros de validação -->
      {% if form.capa.errors %}
      <div class="error">{{ form.capa.errors }}</div>
      {% endif %}

      <!-- Texto auxiliar -->
      <small class="form-text text-muted">
        Formatos aceitos: JPG, PNG, GIF. Tamanho máximo: 5MB.
      </small>
    </div>

    <!-- Campo título -->
    <div class="form-group">
      <label for="{{ form.titulo.id_for_label }}">Título:</label>
      {{ form.titulo }} {% if form.titulo.errors %}
      <div class="error">{{ form.titulo.errors }}</div>
      {% endif %}
    </div>

    <!-- Campo editora -->
    <div class="form-group">
      <label for="{{ form.editora.id_for_label }}">Editora:</label>
      {{ form.editora }} {% if form.editora.errors %}
      <div class="error">{{ form.editora.errors }}</div>
      {% endif %}
    </div>

    <!-- Campo ISBN -->
    <div class="form-group">
      <label for="{{ form.isbn.id_for_label }}">ISBN:</label>
      {{ form.isbn }} {% if form.isbn.errors %}
      <div class="error">{{ form.isbn.errors }}</div>
      {% endif %}
    </div>

    <!-- Campo ano de publicação -->
    <div class="form-group">
      <label for="{{ form.ano_publicacao.id_for_label }}"
        >Ano de publicação:</label
      >
      {{ form.ano_publicacao }} {% if form.ano_publicacao.errors %}
      <div class="error">{{ form.ano_publicacao.errors }}</div>
      {% endif %}
    </div>

    <!-- Campo autores (select múltiplo) -->
    <div class="form-group">
      <label for="{{ form.autores.id_for_label }}">Autores:</label>
      {{ form.autores }} {% if form.autores.errors %}
      <div class="error">{{ form.autores.errors }}</div>
      {% endif %}
    </div>

    <!-- Campo quantidade -->
    <div class="form-group">
      <label for="{{ form.quantidade.id_for_label }}">Quantidade:</label>
      {{ form.quantidade }} {% if form.quantidade.errors %}
      <div class="error">{{ form.quantidade.errors }}</div>
      {% endif %}
    </div>

    <!-- Campo categorias (select múltiplo, ocupa largura total) -->
    <div class="form-group full">
      <label for="{{ form.categorias.id_for_label }}">Categorias:</label>
      {{ form.categorias }} {% if form.categorias.errors %}
      <div class="error">{{ form.categorias.errors }}</div>
      {% endif %}
    </div>

    <!-- Área do botão principal -->
    <div class="btn-area">
      <button type="submit" class="btn-add">Adicionar Livro</button>
    </div>
  </form>
</div>

<!-- POPUP de confirmação -->
<div id="popup" class="popup hidden">
  <div class="popup-content">
    <!-- Botão para fechar o popup -->
    <button class="popup-close" onclick="fecharPopup()">X</button>

    <!-- Mensagem principal -->
    <h2>Livro Salvo <span class="check">✔️</span></h2>

    <!-- Campos dinâmicos -->
    <p>Id: <span id="popup-id"></span></p>
    <p>Nome: <span id="popup-nome"></span></p>
    <button onclick="fecharPopup()" class="btn-add" style="margin-top: 20px">
      OK
    </button>
  </div>
</div>
{% endblock %} {% block scripts %}
<!-- jQuery necessário para Select2 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Select2 -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<!-- Script: Funções do popup -->
<script>
  function abrirPopup(id, nome) {
    document.getElementById("popup-id").innerText = id;
    document.getElementById("popup-nome").innerText = nome;
    document.getElementById("popup").classList.remove("hidden");
  }

  function fecharPopup() {
    document.getElementById("popup").classList.add("hidden");
  }

  // Fechar popup ao clicar fora
  document.getElementById("popup").addEventListener("click", function (e) {
    if (e.target === this) {
      fecharPopup();
    }
  });
</script>

<!-- Ativação dos selects múltiplos -->
<script>
  $(document).ready(function () {
    // Aplica Select2 aos campos de autores e categorias
    $("#id_autores, #id_categorias").select2({
      placeholder: "Selecione...",
      width: "100%",
    });

    // Adiciona classe para estilização
    $("#id_autores, #id_categorias").addClass("multi-select");
  });
</script>

<!-- Caso o livro tenha sido salvo com sucesso -->
{% if sucesso %}
<script>
  abrirPopup("{{ livro_id }}", "{{ livro_nome }}");
</script>
{% endif %} {% endblock %}
